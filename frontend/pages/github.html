<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virax Jr. - GitHub</title>
    <style>/* Same CSS as tasks.html, but adapted for commits */
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Inter:wght@400;500;600&display=swap');
        :root { --bg-color: #1a1b26; --fg-color: #c0caf5; --card-color: #24283b; --border-color: #414868; --accent-color: #bb9af7; --sidebar-bg: #1f2335; --commit-sha-color: #e0af68;}
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--fg-color); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        a { color: var(--accent-color); text-decoration: none; }
        .app-container { display: flex; width: 100%; max-width: 1000px; height: 80vh; background-color: var(--card-color); border-radius: 8px; border: 1px solid var(--border-color); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2); overflow: hidden; }
        #sidebar { width: 300px; background-color: var(--sidebar-bg); padding: 1rem; border-right: 1px solid var(--border-color); overflow-y: auto; }
        #sidebar h2 { font-family: 'Roboto Mono', monospace; font-size: 1.1rem; color: var(--accent-color); margin-top: 0; margin-bottom: 1.5rem; }
        #repo-list-ul { list-style: none; padding: 0; margin: 0; }
        #repo-list-ul li { padding: 10px; border-radius: 5px; cursor: pointer; margin-bottom: 5px; font-weight: 500; transition: background-color 0.2s ease; font-size: 0.9rem; }
        #repo-list-ul li:hover { background-color: #292e42; }
        #repo-list-ul li.active { background-color: var(--accent-color); color: var(--card-color); }
        #main-content { flex-grow: 1; padding: 1.5rem; display: flex; flex-direction: column; }
        #main-header { margin-bottom: 1rem; }
        #main-header h1 { font-size: 1.5rem; font-weight: 600; margin: 0 0 1rem 0; }
        #commit-list-ul { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; }
        #commit-list-ul li { padding: 12px 0; border-bottom: 1px solid var(--border-color); }
        .commit-message { font-weight: 500; margin-bottom: 5px; }
        .commit-details { font-size: 0.8rem; opacity: 0.7; }
        .commit-sha { font-family: 'Roboto Mono', monospace; color: var(--commit-sha-color); }
    </style>
</head>
<body>
    <div class="app-container">
        <aside id="sidebar">
            <h2>Repositories</h2>
            <ul id="repo-list-ul"></ul>
        </aside>
        <main id="main-content">
            <header id="main-header">
                <h1 id="current-repo-title">Select a Repository</h1>
            </header>
            <ul id="commit-list-ul"></ul>
        </main>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_BASE_URL = 'http://127.0.0.1:8000/api/v1/github';
            
            const repoListUl = document.getElementById('repo-list-ul');
            const commitListUl = document.getElementById('commit-list-ul');
            const currentRepoTitleEl = document.getElementById('current-repo-title');

            const renderCommits = (commits) => {
                commitListUl.innerHTML = '';
                if (!commits || commits.length === 0) {
                    commitListUl.innerHTML = '<li>No commits found.</li>';
                    return;
                };
                commits.forEach(commit => {
                    const li = document.createElement('li');
                    const commitDate = new Date(commit.date);
                    li.innerHTML = `
                        <div class="commit-message">${commit.message.split('\\n')[0]}</div>
                        <div class="commit-details">
                            <strong>${commit.author}</strong> committed on ${commitDate.toLocaleDateString()}
                             - <a href="${commit.url}" target="_blank" class="commit-sha">${commit.sha.substring(0, 7)}</a>
                        </div>
                    `;
                    commitListUl.appendChild(li);
                });
            };

            const fetchCommits = async (repoFullName) => {
                try {
                    const response = await fetch(`${API_BASE_URL}/repos/${repoFullName}/commits`);
                    const data = await response.json();
                    renderCommits(data.commits);
                } catch (error) { console.error("Failed to fetch commits:", error); }
            };

            const handleRepoClick = (repoName, repoFullName) => {
                currentRepoTitleEl.textContent = repoName;
                document.querySelectorAll('#repo-list-ul li').forEach(li => li.classList.remove('active'));
                document.querySelector(`li[data-repo-full-name="${repoFullName}"]`).classList.add('active');
                commitListUl.innerHTML = '<li>Loading commits...</li>';
                fetchCommits(repoFullName);
            };

            const loadRepos = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/repos`);
                    const data = await response.json();
                    repoListUl.innerHTML = '';
                    data.repos.forEach(repo => {
                        const li = document.createElement('li');
                        li.textContent = repo.name;
                        li.dataset.repoFullName = repo.full_name;
                        li.addEventListener('click', () => handleRepoClick(repo.name, repo.full_name));
                        repoListUl.appendChild(li);
                    });
                    if (data.repos.length > 0) {
                        const firstRepo = data.repos[0];
                        handleRepoClick(firstRepo.name, firstRepo.full_name);
                    }
                } catch (error) { console.error("Failed to load repos:", error); }
            };

            loadRepos();
        });
    </script>
</body>
</html>